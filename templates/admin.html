<!doctype html>
<html lang="bs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin panel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,'Helvetica Neue',Arial,sans-serif;margin:40px;}
    h1{font-size:2.2rem;margin-bottom:1rem}
    .row{display:flex;gap:16px;align-items:center;margin:.5rem 0}
    input[type=email]{padding:.6rem .8rem;border:1px solid #c9c9c9;border-radius:8px;min-width:280px}
    button{padding:.55rem .9rem;border:0;border-radius:8px;background:#2563eb;color:#fff;cursor:pointer}
    button.del{background:#dc2626}
    table{width:100%;border-collapse:collapse;margin-top:1rem}
    th,td{border-bottom:1px solid #eee;padding:.7rem .6rem;text-align:left}
    .msg{margin-top:.5rem;color:#0a0}
    .warn{color:#b91c1c}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Admin panel</h1>
    <form method="post" action="{{ url_for('odjava') }}">
      <button type="submit">Odjava</button>
    </form>
  </div>

  {% if db_active %}
    <div class="row">
      <form class="row" method="post" action="{{ url_for('admin_add') }}">
        <input type="email" name="email" placeholder="email@domena.com" required />
        <button type="submit">Dodaj</button>
      </form>
    </div>

    {% if message %}
      <div class="msg">{{ message }}</div>
    {% endif %}

    <h2>Dozvoljeni emailovi</h2>
    <table>
      <thead>
        <tr><th>Email</th><th>Akcija</th></tr>
      </thead>
      <tbody>
      {% if emails and emails|length %}
        {% for e in emails %}
          <tr>
            <td>{{ e }}</td>
            <td>
              <form method="post" action="{{ url_for('admin_delete') }}">
                <input type="hidden" name="email" value="{{ e }}">
                <button type="submit" class="del">Obri≈°i</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="2">Nema unosa.</td></tr>
      {% endif %}
      </tbody>
    </table>
  {% else %}
    <p class="warn"><b>Baza nije povezana.</b> Postavi <code>DATABASE_URL</code> ili <code>EXTERNAL_DATABASE_URL</code> na Renderu i kreiraj tabelu
      <code>allowed_emails</code>.</p>
  {% endif %}
</body>
</html>
