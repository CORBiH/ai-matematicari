<!-- MATBOT_REV=manual-test -->

<!DOCTYPE html>
<html lang="bs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- BUILD-MARKER: 2025-08-29 13:59:34 UTC -->
  <title>MAT-BOT</title>

  <script>
    MathJax = { tex: { inlineMath: [["$", "$"], ["\\(", "\\)"]] }, svg: { fontCache: "global" } };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.plot.ly/plotly-2.27.1.min.js"></script>

  <style>
  :root{
    --page-bg:linear-gradient(180deg,#eef5ff 0%,#f7fbff 100%);
    --card-bg:rgba(255,255,255,.92);
    --card-border:rgba(0,0,0,.06);
    --text:#1a1a1a;
    --accent-bot:#4caf50;
    --accent-user:#05afc5;
    --bubble-bg:#eaf7e8;
    --bubble-text:#1a1a1a;
    --btn-bg:#3d7d66;
    --btn-bg-hover:#2f5c4e;
    --danger:#c94f4f;
    --muted:#6b7a86;
  }
  body.dark{
    --page-bg:linear-gradient(180deg,#0d1416 0%,#0a0f11 100%);
    --card-bg:rgba(27,35,39,.90);
    --card-border:rgba(255,255,255,.08);
    --text:#e9f1f3;
    --bubble-bg:#263238;
    --bubble-text:#eef6f8;
    --btn-bg:#2f5c4e;
    --btn-bg-hover:#274a40;
    --muted:#9fb0b9;
  }

  *{box-sizing:border-box}
  body{font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;background:var(--page-bg);color:var(--text);margin:0;padding:100px 0 32px}

  header{position:fixed;top:0;left:0;right:0;z-index:1000;background:#3d7d66;color:#fff;padding:.9rem 1rem;display:flex;align-items:center;justify-content:center;}
  .title-container{font-size:1.85rem;font-weight:700;letter-spacing:.5px;}
  .dropdown{position:absolute;right:1rem;top:.6rem;}
  .dropdown-toggle{background:var(--btn-bg);color:#fff;border:none;padding:.55rem .9rem;font-size:1rem;border-radius:10px;cursor:pointer;}
  .dropdown-toggle:hover{background:var(--btn-bg-hover);}
  .dropdown-content{display:none;position:absolute;top:115%;right:0;min-width:240px;background:var(--card-bg);color:var(--text);border:1px solid var(--card-border);box-shadow:0 12px 30px rgba(0,0,0,.12);border-radius:12px;padding:1rem;backdrop-filter: blur(8px);}
  .dropdown.open .dropdown-content{display:block;}
  .toggle-row{display:flex;align-items:center;justify-content:space-between;gap:.75rem;}
  .toggle-slider{position:relative;width:64px;height:32px;background:#cfd8dc;border-radius:32px;cursor:pointer;transition:background .25s;}
  .toggle-slider::before{content:"";position:absolute;top:3px;left:3px;width:26px;height:26px;background:#fff;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .25s;}
  #darkToggle{display:none;}
  #darkToggle:checked + .toggle-slider{background:#4caf50;}
  #darkToggle:checked + .toggle-slider::before{transform: translateX(32px);}

  main{max-width:900px;margin:0 auto;padding:16px;}
  .card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:16px;padding:1.25rem;box-shadow:0 8px 30px rgba(0,0,0,.08);backdrop-filter: blur(10px);}
  .stack{display:flex;flex-direction:column;gap:1.25rem;}

  #chat-container{display:flex;flex-direction:column;gap:.75rem;max-height:60vh;overflow-y:auto;scroll-behavior:smooth;padding:.25rem .25rem .5rem;border-radius:12px;}
  .qa-pair{display:flex;flex-direction:column;gap:.4rem;margin-bottom:.3rem;}
  .chat-message{display:flex;width:100%;word-break:break-word;}
  .user-message{justify-content:flex-end;}
  .bot-message{justify-content:flex-start;}
  .bubble,.bubble.user{padding:.9rem 1.1rem;border-radius:14px;font-size:1rem;line-height:1.75;box-shadow:0 1px 4px rgba(0,0,0,.05);white-space:pre-wrap;background:var(--bubble-bg);color:var(--bubble-text);max-width:75%;animation:fadeIn .25s ease;}
  .bubble{border-left:4px solid var(--accent-bot);margin:.35rem 0;}
  .bubble.user{background:#c8ebf0;border-right:4px solid var(--accent-user);border-left:0!important;margin:.35rem 0 .35rem auto;max-width:60%;}
  .typing-indicator{align-self:flex-start;font-style:italic;font-size:1rem;padding:.5rem .75rem;color:#444;background:#fff2c2;border-left:4px solid #ffb84d;border-radius:8px;margin:.25rem 0;max-width:320px;display:none;}

  form{display:flex;flex-direction:column;gap:1rem;}
  textarea{width:100%;min-height:140px;padding:1rem;font-size:1.08rem;border-radius:12px;border:2px solid #50e3c2;background:#f8fafd;outline:none;resize:vertical;}
  textarea:focus{border-color:#3d7d66;box-shadow:0 4px 14px rgba(0,0,0,.08);}

  .file-row{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap;}
  .file-input{display:none;}
  .file-chip{display:none;align-items:center;gap:.5rem;background:#eff6ff;border:1px dashed #b9d2ff;color:#2a4365;padding:.45rem .6rem;border-radius:999px;font-size:.92rem;}
  .file-chip.show{display:inline-flex;}
  .file-chip .remove{background:transparent;border:none;font-size:1rem;cursor:pointer;color:#2a4365;}

  .btn{background:var(--btn-bg);color:#fff;border:none;padding:.65rem .9rem;font-size:.95rem;border-radius:10px;cursor:pointer;width:fit-content;transition: transform .05s ease, background .15s ease;}
  .btn:hover{background:var(--btn-bg-hover);}
  .btn.danger{background:var(--danger);}

  .form-actions{display:flex;flex-direction:column;gap:.6rem;align-items:flex-start;padding-top:.75rem;border-top:1px solid var(--card-border);}
  .form-actions .btn{min-width:160px;text-align:center;}
  </style>
</head>
<body>
<header id="main-header">
  <div class="title-container">MAT-BOT</div>
  <div class="dropdown" id="menuWrap">
    <button class="dropdown-toggle" onclick="toggleDropdown(event)">‚ò∞ Meni</button>
    <div class="dropdown-content">
      <div class="toggle-row">
        <span class="toggle-label">üåô Dark Mode</span>
        <label style="display:flex;align-items:center;gap:.5rem;">
          <input type="checkbox" id="darkToggle"><span class="toggle-slider"></span>
        </label>
      </div>
      <hr>
      <button onclick="resetRazred()" class="btn danger">üîÑ Promijeni razred</button>
    </div>
  </div>
</header>

<main class="stack">
  <div class="card">
    <div id="chat-container">
      {% for message in history %}
      <div class="qa-pair">
        <div class="chat-message user-message"><div class="bubble user"><p>{{ message.user }}</p></div></div>
        <div class="chat-message bot-message"><div class="bubble">{{ message.bot|safe }}</div></div>
      </div>
      {% endfor %}
      <div id="typing" class="typing-indicator">ü§ñ MAT-BOT pi≈°e odgovor‚Ä¶</div>
    </div>
  </div>

  <div class="card">
    <form id="ask-form" method="POST" enctype="multipart/form-data" autocomplete="off" action="/submit">
      <div id="razred-wrapper" {% if razred %}style="display:none"{% endif %}>
        <label for="razred">Koji si razred?</label>
        <select name="razred" id="razred" required>
          <option value="" disabled selected>-- Odaberi razred --</option>
          <option value="5">5. razred</option>
          <option value="6">6. razred</option>
          <option value="7">7. razred</option>
          <option value="8">8. razred</option>
          <option value="9">9. razred</option>
        </select>
      </div>

      <label for="pitanje">Postavi pitanje (tekst ili slika):</label>
      <textarea name="pitanje" id="pitanje" placeholder="Unesi zadatak..." autofocus></textarea>

      <div class="form-actions">
        <label for="slika">üìé Izaberi fajl / Kamera</label>
        <input class="file-input" id="slika" type="file" name="file" accept="image/*" />
        <span id="file-chip" class="file-chip"><span id="file-name"></span><button type="button" id="remove-file">√ó</button></span>

        <button id="sendBtn" type="button" class="btn">‚úâÔ∏è Po≈°alji</button>
        <button type="submit" form="clear-form" class="btn danger">üóëÔ∏è Ocisti chat</button>
        <button type="button" onclick="resetRazred()" class="btn">üîÑ Promijeni razred</button>
      </div>
    </form>
    <form id="clear-form" method="POST" action="/clear">
      <input type="hidden" name="ajax" value="1" />
      <input type="hidden" name="confirm_clear" value="1" />
    </form>
  </div>
</main>

<script>
function toggleDropdown(e){ e.preventDefault(); document.getElementById('menuWrap').classList.toggle('open'); }
function initDarkToggle(){
  const cb=document.getElementById('darkToggle'); const saved=localStorage.getItem('matbot_dark')==='1';
  if(saved){document.body.classList.add('dark');cb.checked=true;}
  cb.addEventListener('change',()=>{document.body.classList.toggle('dark',cb.checked);localStorage.setItem('matbot_dark',cb.checked?'1':'0');});
}
function showTyping(){document.getElementById('typing').style.display='block';}
function hideTyping(){document.getElementById('typing').style.display='none';}
function resetRazred(){
  document.getElementById('razred-wrapper').style.display='block';
  document.getElementById('chat-container').innerHTML='<div id="typing" class="typing-indicator">ü§ñ MAT-BOT pi≈°e odgovor‚Ä¶</div>';
  localStorage.clear();
}
document.addEventListener('DOMContentLoaded',initDarkToggle);
</script>
</body>
</html>
